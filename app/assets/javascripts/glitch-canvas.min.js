!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.glitch=b()}(this,function(){function p(d,e,f){if(y(d)&&z(e,"parameters","object")&&z(f,"callback","function")){for(h=x(e),q(a,d),q(b,d),i=s(d,h.quality),j=u(i),k=t(j),n=0,o=h.iterations;o>n;n++)r(j,k,h.seed,h.amount,n,h.iterations);l=new Image,l.onload=function(){c.drawImage(l,0,0),m=c.getImageData(0,0,d.width,d.height),f(m)},l.src=v(j)}}function q(a,b){a.width!==b.width&&(a.width=b.width),a.height!==b.height&&(a.height=b.height)}function r(a,b,c,d,e,f){var g=a.length-b-4,h=parseInt(g/f*e,10),i=parseInt(g/f*(e+1),10),j=i-h,k=parseInt(h+j*c,10);k>g&&(k=g);var l=Math.floor(b+k);a[l]=Math.floor(256*d)}function s(a,c){var e="number"==typeof c&&1>c&&c>0?c:.1;d.putImageData(a,0,0);var f=b.toDataURL("image/jpeg",e);switch(f.length%4){case 3:f+="=";break;case 2:f+="==";break;case 1:f+="==="}return f}function t(a){var b=417;for(n=0,o=a.length;o>n;n++)if(255===a[n]&&218===a[n+1]){b=n+2;break}return b}function u(a){var c,d,e,b=[];for(n=23,o=a.length;o>n;n++){switch(d=g[a.charAt(n)],c=(n-23)%4){case 1:b.push(e<<2|d>>4);break;case 2:b.push((15&e)<<4|d>>2);break;case 3:b.push((3&e)<<6|d)}e=d}return b}function v(a){var c,d,e,b=["data:image/jpeg;base64,"];for(n=0,o=a.length;o>n;n++){switch(d=a[n],c=n%3){case 0:b.push(f[d>>2]);break;case 1:b.push(f[(3&e)<<4|d>>4]);break;case 2:b.push(f[(15&e)<<2|d>>6]),b.push(f[63&d])}e=d}return 0===c?(b.push(f[(3&e)<<4]),b.push("==")):1===c&&(b.push(f[(15&e)<<2]),b.push("=")),b.join("")}function x(a){return{seed:(a.seed||0)/100,quality:(a.quality||0)/100,amount:(a.amount||0)/100,iterations:a.iterations||0}}function y(a){return z(a,"image_data","object")&&z(a.width,"image_data.width","number")&&z(a.height,"image_data.height","number")&&z(a.data,"image_data.data","object")&&z(a.data.length,"image_data.data.length","number")&&A(a.data.length,"image_data.data.length",B,"> 0")?!0:!1}function z(a,b,c){return typeof a===c?!0:(C(a,"typeof "+b,'"'+c+'"','"'+typeof a+'"'),!1)}function A(a,b,c,d){return c(a)===!0?!0:(C(a,b,d,"not"),void 0)}function B(a){return a>0}function C(a,b,c,d){throw new Error("glitch(): Expected "+b+" to be "+c+", but it was "+d+".")}var h,i,j,k,l,m,n,o,a=document.createElement("canvas"),b=document.createElement("canvas"),c=a.getContext("2d"),d=b.getContext("2d"),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=e.split(""),g={};return f.forEach(function(a,b){g[a]=b}),p});